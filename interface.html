async function loadImages() {
  onValue(dbRef(db, 'posts'), (snapshot) => {
    feed.innerHTML = ''; // Clear existing posts

    snapshot.forEach((postSnapshot) => {
      const post = postSnapshot.val();
      
      // Check if imageUrl is valid
      if (post.imageUrl) {
        const postElement = document.createElement('div');
        postElement.classList.add('post');
        postElement.innerHTML = `
          <img src="${post.imageUrl}" alt="Image" />
          <button class="like-btn">❤️ ${post.likes} Likes</button>
          <div class="comments"></div>
          <input type="text" class="comment-input" placeholder="Add a comment" />
          <button class="comment-btn">Post</button>
        `;

        // Handle Like button
        postElement.querySelector('.like-btn').addEventListener('click', () => {
          const userId = auth.currentUser.uid; // Get current user's ID
          const likedBy = post.likedBy || []; // Get current likedBy array

          if (!likedBy.includes(userId)) {
            likedBy.push(userId); // Add user ID to likedBy array
            update(dbRef(db, 'posts/' + postSnapshot.key), { 
              likes: post.likes + 1,
              likedBy: likedBy 
            });
          } else {
            alert('You already liked this image!');
          }
        });

        // Handle Comment button
        postElement.querySelector('.comment-btn').addEventListener('click', () => {
          const commentInput = postElement.querySelector('.comment-input');
          const comment = commentInput.value;
          const username = auth.currentUser.displayName || 'Anonymous'; // Get current user's username
          if (comment) {
            const newComments = [...(post.comments || []), { username, content: comment }];
            update(dbRef(db, 'posts/' + postSnapshot.key), { comments: newComments });
            commentInput.value = ''; // Clear input
          }
        });

        // Render comments
        const commentsDiv = postElement.querySelector('.comments');
        (post.comments || []).forEach(({ username, content }) => {
          const commentElement = document.createElement('p');
          commentElement.textContent = `${username}: ${content}`;
          commentsDiv.appendChild(commentElement);
        });

        feed.appendChild(postElement);
      }
    });
  });
}
